{"version":3,"file":"HomePage.mjs","sources":["../../../../../../admin/src/pages/Home/HomePage.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport { Box, Flex, Grid, Main, Typography } from '@strapi/design-system';\nimport { CheckCircle, Pencil, PuzzlePiece } from '@strapi/icons';\nimport { useIntl } from 'react-intl';\nimport { Link as ReactRouterLink } from 'react-router-dom';\n\nimport { Layouts } from '../../components/Layouts/Layout';\nimport { Page } from '../../components/PageHelpers';\nimport { Widget } from '../../components/WidgetHelpers';\nimport { useEnterprise } from '../../ee';\nimport { useAuth } from '../../features/Auth';\nimport { useStrapiApp } from '../../features/StrapiApp';\n\nimport { LastEditedWidget, LastPublishedWidget } from './components/ContentManagerWidgets';\nimport { GuidedTour } from './components/GuidedTour';\n\nimport type { WidgetType } from '@strapi/admin/strapi-admin';\n\n/* -------------------------------------------------------------------------------------------------\n * WidgetRoot\n * -----------------------------------------------------------------------------------------------*/\n\ninterface WidgetRootProps extends Pick<WidgetType, 'title' | 'icon' | 'permissions' | 'link'> {\n  children: React.ReactNode;\n}\n\nexport const WidgetRoot = ({\n  title,\n  icon = PuzzlePiece,\n  permissions = [],\n  children,\n  link,\n}: WidgetRootProps) => {\n  const { formatMessage } = useIntl();\n  const id = React.useId();\n  const Icon = icon;\n\n  const [permissionStatus, setPermissionStatus] = React.useState<\n    'loading' | 'granted' | 'forbidden'\n  >('loading');\n  const checkUserHasPermissions = useAuth('WidgetRoot', (state) => state.checkUserHasPermissions);\n  React.useEffect(() => {\n    const checkPermissions = async () => {\n      const matchingPermissions = await checkUserHasPermissions(permissions);\n      const shouldGrant = matchingPermissions.length >= permissions.length;\n      setPermissionStatus(shouldGrant ? 'granted' : 'forbidden');\n    };\n\n    if (\n      // TODO: remove unstable check once widgets API is stable\n      !window.strapi.future.isEnabled('unstableWidgetsApi') ||\n      !permissions ||\n      permissions.length === 0\n    ) {\n      setPermissionStatus('granted');\n    } else {\n      checkPermissions();\n    }\n  }, [checkUserHasPermissions, permissions]);\n\n  return (\n    <Flex\n      width=\"100%\"\n      hasRadius\n      direction=\"column\"\n      alignItems=\"flex-start\"\n      background=\"neutral0\"\n      borderColor=\"neutral150\"\n      shadow=\"tableShadow\"\n      tag=\"section\"\n      gap={4}\n      padding={6}\n      aria-labelledby={id}\n    >\n      <Flex direction=\"row\" gap={2} justifyContent=\"space-between\" width=\"100%\" tag=\"header\">\n        <Flex gap={2}>\n          <Icon fill=\"neutral500\" aria-hidden />\n          <Typography textColor=\"neutral500\" variant=\"sigma\" tag=\"h2\" id={id}>\n            {formatMessage(title)}\n          </Typography>\n        </Flex>\n        {link && (\n          <Typography\n            tag={ReactRouterLink}\n            variant=\"omega\"\n            textColor=\"primary600\"\n            style={{ textDecoration: 'none' }}\n            to={link.href}\n          >\n            {formatMessage(link.label)}\n          </Typography>\n        )}\n      </Flex>\n      <Box width=\"100%\" height=\"261px\" overflow=\"auto\" tag=\"main\">\n        {permissionStatus === 'loading' && <Widget.Loading />}\n        {permissionStatus === 'forbidden' && <Widget.NoPermissions />}\n        {permissionStatus === 'granted' && children}\n      </Box>\n    </Flex>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * UnstableHomePageCe\n * -----------------------------------------------------------------------------------------------*/\n\nconst WidgetComponent = ({ component }: { component: () => Promise<React.ComponentType> }) => {\n  const [loadedComponent, setLoadedComponent] = React.useState<React.ComponentType | null>(null);\n\n  React.useEffect(() => {\n    const loadComponent = async () => {\n      const resolvedComponent = await component();\n\n      setLoadedComponent(() => resolvedComponent);\n    };\n\n    loadComponent();\n  }, [component]);\n\n  const Component = loadedComponent;\n\n  if (!Component) {\n    return <Widget.Loading />;\n  }\n\n  return <Component />;\n};\n\nconst UnstableHomePageCe = () => {\n  const { formatMessage } = useIntl();\n  const user = useAuth('HomePageCE', (state) => state.user);\n  const displayName = user?.firstname ?? user?.username ?? user?.email;\n\n  const getAllWidgets = useStrapiApp('UnstableHomepageCe', (state) => state.widgets.getAll);\n\n  return (\n    <Main>\n      <Page.Title>\n        {formatMessage({ id: 'HomePage.head.title', defaultMessage: 'Homepage' })}\n      </Page.Title>\n      <Layouts.Header\n        title={formatMessage(\n          { id: 'HomePage.header.title', defaultMessage: 'Hello {name}' },\n          { name: displayName }\n        )}\n        subtitle={formatMessage({\n          id: 'HomePage.header.subtitle',\n          defaultMessage: 'Welcome to your administration panel',\n        })}\n      />\n      <Layouts.Content>\n        <Flex direction=\"column\" alignItems=\"stretch\" gap={8} paddingBottom={10}>\n          <GuidedTour />\n          <Grid.Root gap={5}>\n            {getAllWidgets().map((widget) => {\n              return (\n                <Grid.Item col={6} s={12} key={widget.uid}>\n                  <WidgetRoot\n                    title={widget.title}\n                    icon={widget.icon}\n                    permissions={widget.permissions}\n                    link={widget.link}\n                  >\n                    <WidgetComponent component={widget.component} />\n                  </WidgetRoot>\n                </Grid.Item>\n              );\n            })}\n          </Grid.Root>\n        </Flex>\n      </Layouts.Content>\n    </Main>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * HomePageCE\n * -----------------------------------------------------------------------------------------------*/\n\nconst HomePageCE = () => {\n  const { formatMessage } = useIntl();\n  const user = useAuth('HomePageCE', (state) => state.user);\n  const displayName = user?.firstname ?? user?.username ?? user?.email;\n\n  if (window.strapi.future.isEnabled('unstableWidgetsApi')) {\n    return <UnstableHomePageCe />;\n  }\n\n  return (\n    <Main>\n      <Page.Title>\n        {formatMessage({ id: 'HomePage.head.title', defaultMessage: 'Homepage' })}\n      </Page.Title>\n      <Layouts.Header\n        title={formatMessage(\n          { id: 'HomePage.header.title', defaultMessage: 'Hello {name}' },\n          { name: displayName }\n        )}\n        subtitle={formatMessage({\n          id: 'HomePage.header.subtitle',\n          defaultMessage: 'Welcome to your administration panel',\n        })}\n      />\n      <Layouts.Content>\n        <Flex direction=\"column\" alignItems=\"stretch\" gap={8} paddingBottom={10}>\n          <GuidedTour />\n          <Grid.Root gap={5}>\n            <Grid.Item col={6} s={12}>\n              <WidgetRoot\n                title={{\n                  id: 'content-manager.widget.last-edited.title',\n                  defaultMessage: 'Last edited entries',\n                }}\n                icon={Pencil}\n              >\n                <LastEditedWidget />\n              </WidgetRoot>\n            </Grid.Item>\n            <Grid.Item col={6} s={12}>\n              <WidgetRoot\n                title={{\n                  id: 'content-manager.widget.last-published.title',\n                  defaultMessage: 'Last published entries',\n                }}\n                icon={CheckCircle}\n              >\n                <LastPublishedWidget />\n              </WidgetRoot>\n            </Grid.Item>\n          </Grid.Root>\n        </Flex>\n      </Layouts.Content>\n    </Main>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * HomePage\n * -----------------------------------------------------------------------------------------------*/\n\nconst HomePage = () => {\n  const Page = useEnterprise(\n    HomePageCE,\n    // eslint-disable-next-line import/no-cycle\n    async () => (await import('../../../../ee/admin/src/pages/HomePage')).HomePageEE\n  );\n\n  // block rendering until the EE component is fully loaded\n  if (!Page) {\n    return null;\n  }\n\n  return <Page />;\n};\n\nexport { HomePage, HomePageCE };\n"],"names":["WidgetRoot","title","icon","PuzzlePiece","permissions","children","link","formatMessage","useIntl","id","React","useId","Icon","permissionStatus","setPermissionStatus","useState","checkUserHasPermissions","useAuth","state","useEffect","checkPermissions","matchingPermissions","shouldGrant","length","window","strapi","future","isEnabled","_jsxs","Flex","width","hasRadius","direction","alignItems","background","borderColor","shadow","tag","gap","padding","aria-labelledby","justifyContent","_jsx","fill","aria-hidden","Typography","textColor","variant","ReactRouterLink","style","textDecoration","to","href","label","Box","height","overflow","Widget","Loading","NoPermissions","WidgetComponent","component","loadedComponent","setLoadedComponent","loadComponent","resolvedComponent","Component","UnstableHomePageCe","user","displayName","firstname","username","email","getAllWidgets","useStrapiApp","widgets","getAll","Main","Page","Title","defaultMessage","Layouts","Header","name","subtitle","Content","paddingBottom","GuidedTour","Grid","Root","map","widget","Item","col","s","uid","HomePageCE","Pencil","LastEditedWidget","CheckCircle","LastPublishedWidget","HomePage","useEnterprise","HomePageEE"],"mappings":"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"}